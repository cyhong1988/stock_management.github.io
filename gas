function doPost(e) {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = ss.getSheets()[0];
  var data = JSON.parse(e.postData.contents);
  
  // 刪除邏輯
  if (data.action === "delete") {
    var rows = sheet.getDataRange().getValues();
    // 從最後一行往回找 (避免刪除後索引跑掉)
    for (var i = rows.length - 1; i >= 1; i--) {
      var rowName = String(rows[i][2]); // 假設第 3 欄是股票名稱
      var rowNet = Math.round(rows[i][6]); // 假設第 7 欄是淨損益
      
      // 同時比對名稱與金額，避免誤刪
      if (rowName === String(data.name) && rowNet === Number(data.net)) {
        sheet.deleteRow(i + 1);
        return ContentService.createTextOutput("Delete Success");
      }
    }
  } 
  
  // 新增邏輯 (維持原樣)
  else {
    sheet.appendRow([
      data.buyDate, data.sellDate, data.name, data.buyPrice, 
      data.sellPrice, data.quantity, data.net, data.pct
    ]);
    return ContentService.createTextOutput("Add Success");
  }
}
