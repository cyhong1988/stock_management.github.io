function doPost(e) {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = ss.getSheets()[0];
  var data = JSON.parse(e.postData.contents);
  
  if (data.action === "delete") {
    var rows = sheet.getDataRange().getValues();
    for (var i = rows.length - 1; i >= 1; i--) {
      var rowName = String(rows[i][2]); 
      var rowNet  = Math.round(rows[i][4]);
      
      if (rowName === String(data.name) && rowNet === Number(data.net)) {
        sheet.deleteRow(i + 1);
        return ContentService.createTextOutput("Delete Success");
      }
    }
    return ContentService.createTextOutput("Not Found");
  } 
  else {
    // 在日期變數前面加上 "'" 符號，強制 Google Sheets 以文字儲存
    sheet.appendRow([
      "'" + data.buyDate,   // 買進日期 (索引0)
      "'" + data.sellDate,  // 賣出日期 (索引1)
      data.name,            // 股票名稱 (索引2)
      data.quantity,        // 股數 (索引3)
      data.net,             // 淨損益 (索引4)
      data.pct,             // 報酬率 (索引5)
      data.buyPrice,        // 買進價 (索引6)
      data.sellPrice        // 賣出價 (索引7)
    ]);
    return ContentService.createTextOutput("Add Success");
  }
}
