// 1. 處理寫入資料 (POST)
function doPost(e) {
  try {
    var params = JSON.parse(e.postData.contents);
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    
    // 按照試算表欄位順序寫入：買進, 賣出, 名稱, 股數, 淨損益, 報酬率
    sheet.appendRow([
      params.buyDate,
      params.sellDate,
      params.name,
      params.quantity, // 新增股數欄位
      params.net,
      params.pct
    ]);
    
    return ContentService.createTextOutput(JSON.stringify({"result": "success"}))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (err) {
    return ContentService.createTextOutput(JSON.stringify({"result": "error", "message": err.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// 2. 處理讀取資料 (GET) - 若未來需要自動載入歷史紀錄
function doGet() {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var data = sheet.getDataRange().getValues();
  var rows = [];
  
  // 從第 2 行開始抓 (跳過標題)
  for (var i = 1; i < data.length; i++) {
    rows.push({
      buyDate: data[i][0],
      sellDate: data[i][1],
      name: data[i][2],
      quantity: data[i][3], // 新增股數
      net: data[i][4],
      pct: data[i][5]
    });
  }
  
  return ContentService.createTextOutput(JSON.stringify(rows))
    .setMimeType(ContentService.MimeType.JSON);
}
